<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Movie Voting</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: auto;
      padding: 20px;
    }
    .movie-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 20px;
    }
    .movie {
      text-align: center;
      position: relative;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 10px;
      background: #f9f9f9;
    }
    .movie img {
      width: 100%;
      height: auto;
      cursor: pointer;
      border-radius: 8px;
    }
    .vote-count {
      margin-top: 8px;
      font-weight: bold;
    }
    .delete-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: red;
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      padding: 4px 8px;
    }
    input[type="text"] {
      padding: 8px;
      width: 70%;
      margin-right: 10px;
    }
    button {
      padding: 8px 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>üé¨ Movie Voting Page</h2>

  <h3>Upload Movie by Image URL</h3>
  <input type="text" id="imageUrl" placeholder="Enter image URL..." />
  <button onclick="uploadMovie()">Upload</button>

  <div class="movie-grid"></div>

  <button id="resultBtn" style="margin-top: 20px;">Show Top Voted Movie</button>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const movieVotes = {};

    function renderMovies(movies) {
      const grid = document.querySelector('.movie-grid');
      grid.innerHTML = '';

      movies.forEach(movie => {
        const div = document.createElement('div');
        div.className = 'movie';
        div.setAttribute('data-id', movie.id);

        div.innerHTML = `
          <img src="${movie.image}" alt="Movie Image" />
          <div class="vote-count">Votes: ${movie.votes}</div>
          ${movie.uploaded ? `<button class="delete-btn">üóëÔ∏è</button>` : ''}
        `;

        div.querySelector('img').addEventListener('click', () => {
          socket.emit('voteMovie', movie.id);
        });

        const deleteBtn = div.querySelector('.delete-btn');
        if (deleteBtn) {
          deleteBtn.addEventListener('click', () => {
            socket.emit('deleteMovie', movie.id);
          });
        }

        grid.appendChild(div);
      });
    }

    socket.emit('getVotes');

    socket.on('updateVotes', (movieList) => {
      movieList.forEach(m => (movieVotes[m.id] = m.votes));
      renderMovies(movieList);
    });

    document.getElementById('resultBtn').addEventListener('click', () => {
      const top = Object.entries(movieVotes).reduce((acc, [id, votes]) => {
        if (!acc || votes > acc.votes) return { id, votes };
        if (votes === acc.votes) acc.id += `, ${id}`;
        return acc;
      }, null);

      if (!top || top.votes === 0) return alert("No votes yet!");
      alert(`üéâ Top Voted Movie(s): ${top.id} (${top.votes} vote${top.votes > 1 ? 's' : ''})`);
    });

    function uploadMovie() {
      const imageUrl = document.getElementById('imageUrl').value;
      if (imageUrl) {
        socket.emit('addMovie', imageUrl);
        document.getElementById('imageUrl').value = '';
      }
    }
  </script>
</body>
</html>
