<script>
    let socket = io();
    let form = document.getElementById('form');
    let myname = document.getElementById('myname');
    let room = document.getElementById('room');
    let message = document.getElementById('message');
    let messageArea = document.getElementById('messageArea');

    let username = '';
    let roomname = '';

    form.addEventListener('submit', (e) => {
        e.preventDefault();

        if (!username || !roomname) {
            username = myname.value;
            roomname = room.value;
            socket.emit('join-room', roomname);
        }

        if (message.value) {
            socket.emit('chat-message', {
                user: username,
                text: message.value,
                room: roomname
            });
            message.value = '';
        }
    });

    socket.on('chat-message', (data) => {
        let chat = document.createElement('div');
        chat.classList.add('message');
        chat.classList.add(data.user === username ? 'sent' : 'received');
        chat.innerHTML = `<span class="username">${data.user}:</span> ${data.text}`;
        messageArea.appendChild(chat);
        messageArea.scrollTop = messageArea.scrollHeight;
    });
</script>
